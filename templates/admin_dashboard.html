<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | Elements by Chef Sultan</title>
<div id="date-controls" style="margin-bottom: 25px;">
  <button onclick="setAllowedDays()">ðŸŸ¡ Set Allowed Weekdays</button>
  <button onclick="setDateRange()">ðŸŸ¢ Set Allowed Date Range</button>
  <button onclick="resetSettings()">ðŸ”´ Reset All Restrictions</button>
</div>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sortable/0.8.0/js/sortable.min.js"></script>
  <style>
    body {
      background-color: #000;
      color: #d4af37;
      font-family: 'Georgia', serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #f5d76e;
      margin-bottom: 30px;
    }
    table {
      width: 95%;
      margin: auto;
      border-collapse: collapse;
      box-shadow: 0 0 10px #d4af37;
    }
    th, td {
      border: 1px solid #d4af37;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #111;
      color: #f5d76e;
      text-transform: uppercase;
      font-size: 0.9rem;
      cursor: pointer;
    }
    tr:nth-child(even) { background-color: #111; }
    tr:hover { background-color: #222; }
    input {
      width: 100%;
      background: transparent;
      border: none;
      color: #d4af37;
      text-align: center;
      outline: none;
    }
    button {
      background-color: #d4af37;
      color: #000;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background-color: #b89c30; }
    .logout {
      color: #d4af37;
      text-decoration: none;
      border: 1px solid #d4af37;
      padding: 8px 14px;
      border-radius: 5px;
      display: inline-block;
      margin-bottom: 20px;
    }
    .logout:hover {
      background-color: #d4af37;
      color: #000;
    }
    tfoot td {
      font-weight: bold;
      background-color: #111;
      color: #f5d76e;
    }
  </style>
</head>
<body>
  <h1>Admin Dashboard</h1>
<div style="
  background-color:#111;
  border:1px solid #d4af37;
  color:#f5d76e;
  padding:10px;
  margin:15px auto;
  width:80%;
  border-radius:8px;
  box-shadow:0 0 10px #d4af37;
  font-size:1.1rem;
">
  <strong>Active Booking Rules:</strong><br>
  Open on <span style="color:#ffd700;">{{ allowed_days | join(', ') }}</span><br>
  From <span style="color:#ffd700;">{{ start_date }}</span> to <span style="color:#ffd700;">{{ end_date }}</span>
</div>

  <a href="{{ url_for('admin_logout') }}" class="logout">Logout</a>

  <table id="bookingsTable" class="sortable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Date</th>
        <th>Time</th>
        <th>Meal Guests</th>
        <th>Drinks Guests</th>
        <th>Total (Â£)</th>
        <th>Reservation Code</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for booking in bookings %}
      <tr data-id="{{ booking[0] }}">
        <td>{{ booking[0] }}</td>
        <td><input value="{{ booking[1] }}"></td>
        <td><input value="{{ booking[2] }}"></td>
        <td><input value="{{ booking[3] }}"></td>
        <td><input value="{{ booking[4] }}"></td>
        <td><input value="{{ booking[5] }}"></td>
        <td><input value="{{ booking[6] }}"></td>
        <td><input value="{{ booking[7] }}"></td>
        <td><input value="{{ booking[8] }}"></td>
        <td>{{ booking[9] }}</td>
        <td>
          <button onclick="saveBooking({{ booking[0] }})">ðŸ’¾ Save</button>
          <button onclick="deleteBooking({{ booking[0] }})">ðŸ—‘ Delete</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
<tfoot>
    <tr>
        <td colspan="6" style="text-align:right; font-weight:bold;">Totals:</td>
        <td>{{ bookings | sum(attribute=6) }}</td>
        <td>{{ bookings | sum(attribute=7) }}</td>
        <td>Â£{{ "%.2f"|format(bookings | sum(attribute=8)) }}</td>
        <td colspan="2"></td>
    </tr>
</tfoot>

  </table>

  <script src="{{ url_for('static', filename='admin.js') }}"></script>
<script>
function setAllowedDays() {
  const input = prompt("Enter allowed weekdays as numbers (0=Sun, 6=Sat). Example: 4,5,6 for Thu-Fri-Sat");
  if (!input) return;
  const days = input.split(",").map(x => parseInt(x.trim()));
  fetch("/admin/set_weekdays", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ allowed_days: days })
  })
  .then(r => r.json())
  .then(res => alert(res.message || "Updated!"));
}

function setDateRange() {
  const start = prompt("Enter start date (YYYY-MM-DD)", "2025-12-11");
  const end = prompt("Enter end date (YYYY-MM-DD)", "2026-02-14");
  if (!start || !end) return;
  fetch("/admin/set_date_range", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ start_date: start, end_date: end })
  })
  .then(r => r.json())
  .then(res => alert(res.message || "Date range updated!"));
}

function resetSettings() {
  if (!confirm("Reset all booking restrictions?")) return;
  fetch("/admin/reset_settings", { method: "POST" })
  .then(r => r.json())
  .then(res => alert(res.message || "Reset complete!"));
}
</script>
<script>
function setAllowedDays() {
  const input = prompt("Enter allowed weekdays (0=Sun, 6=Sat). Example: 4,5,6 for Thu-Fri-Sat");
  if (!input) return;
  const days = input.split(",").map(x => parseInt(x.trim()));
  fetch("/admin/set_weekdays", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ allowed_days: days })
  })
  .then(r => r.json())
  .then(res => alert(res.message || "Updated!"));
}

function setDateRange() {
  const start = prompt("Enter start date (YYYY-MM-DD)", "2025-12-11");
  const end = prompt("Enter end date (YYYY-MM-DD)", "2026-02-14");
  if (!start || !end) return;
  fetch("/admin/set_date_range", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ start_date: start, end_date: end })
  })
  .then(r => r.json())
  .then(res => alert(res.message || "Date range updated!"));
}

function resetSettings() {
  if (!confirm("Reset all booking restrictions?")) return;
  fetch("/admin/reset_settings", { method: "POST" })
  .then(r => r.json())
  .then(res => alert(res.message || "Reset complete!"));
}
</script>

</body>
</html>

